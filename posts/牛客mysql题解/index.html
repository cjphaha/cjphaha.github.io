<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>牛客mysql题解 - 氕氘氚</title><meta name="Description" content=""><meta property="og:title" content="牛客mysql题解" />
<meta property="og:description" content="链接： https://www.nowcoder.com/ta/sql SQL1 SELECT * from employees Order BY hire_date DESC LIMIT 1; SQL2 -- OFFSET要在limit后面，这样可以选出倒数第三个 SELECT * from employees Order BY hire_date DESC LIMIT 1 OFFSET 2; SQL3 SELECT salaries.*,dept_manager.dept_no FROM salaries LEFT JOIN dept_manager ON salaries.emp_no = dept_manager.emp_no WHERE salaries.to_date=&#39;9999-01-01&#39;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://cjpa.top/posts/%E7%89%9B%E5%AE%A2mysql%E9%A2%98%E8%A7%A3/" />
<meta property="og:image" content="http://cjpa.top/logo.png"/>
<meta property="article:published_time" content="2021-01-03T13:22:33+08:00" />
<meta property="article:modified_time" content="2021-01-03T13:22:33+08:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="http://cjpa.top/logo.png"/>

<meta name="twitter:title" content="牛客mysql题解"/>
<meta name="twitter:description" content="链接： https://www.nowcoder.com/ta/sql SQL1 SELECT * from employees Order BY hire_date DESC LIMIT 1; SQL2 -- OFFSET要在limit后面，这样可以选出倒数第三个 SELECT * from employees Order BY hire_date DESC LIMIT 1 OFFSET 2; SQL3 SELECT salaries.*,dept_manager.dept_no FROM salaries LEFT JOIN dept_manager ON salaries.emp_no = dept_manager.emp_no WHERE salaries.to_date=&#39;9999-01-01&#39;"/>
<meta name="application-name" content="氕氘氚">
<meta name="apple-mobile-web-app-title" content="氕氘氚"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://cjpa.top/posts/%E7%89%9B%E5%AE%A2mysql%E9%A2%98%E8%A7%A3/" /><link rel="prev" href="http://cjpa.top/posts/nginx/" /><link rel="next" href="http://cjpa.top/posts/mysql%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "牛客mysql题解",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/cjpa.top\/posts\/%E7%89%9B%E5%AE%A2mysql%E9%A2%98%E8%A7%A3\/"
        },"genre": "posts","keywords": "SQL","wordcount":  2072 ,
        "url": "http:\/\/cjpa.top\/posts\/%E7%89%9B%E5%AE%A2mysql%E9%A2%98%E8%A7%A3\/","datePublished": "2021-01-03T13:22:33+08:00","dateModified": "2021-01-03T13:22:33+08:00","publisher": {
            "@type": "Organization",
            "name": "氕氘氚"},"author": {
                "@type": "Person",
                "name": "氕氘氚"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : '' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="氕氘氚"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/images/avatar.png"
        data-srcset="/images/avatar.png, /images/avatar.png 1.5x, /images/avatar.png 2x"
        data-sizes="auto"
        alt="/images/avatar.png"
        title="/images/avatar.png" />氕氘氚的博客</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/index.html"> 文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="氕氘氚"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/images/avatar.png"
        data-srcset="/images/avatar.png, /images/avatar.png 1.5x, /images/avatar.png 2x"
        data-sizes="auto"
        alt="/images/avatar.png"
        title="/images/avatar.png" />氕氘氚的博客</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/index.html" title="">文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">牛客mysql题解</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>氕氘氚</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/%E5%88%B7%E9%A2%98/"><i class="far fa-folder fa-fw"></i>刷题</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2021-01-03">2021-01-03</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 2072 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 5 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#sql1">SQL1</a></li>
    <li><a href="#sql2">SQL2</a></li>
    <li><a href="#sql3">SQL3</a></li>
    <li><a href="#sql4">SQL4</a></li>
    <li><a href="#sql5">SQL5</a></li>
    <li><a href="#sql6">SQL6</a></li>
    <li><a href="#sql7">SQL7</a></li>
    <li><a href="#sql8">SQL8</a></li>
    <li><a href="#sql9">SQL9</a></li>
    <li><a href="#sql10">SQL10</a></li>
    <li><a href="#sql11">SQL11</a></li>
    <li><a href="#sql12">SQL12</a></li>
    <li><a href="#sql13">SQL13</a></li>
    <li><a href="#sql14">SQL14</a></li>
    <li><a href="#sql15">SQL15</a></li>
    <li><a href="#sql16">SQL16</a></li>
    <li><a href="#sql17">SQL17</a></li>
    <li><a href="#sql18">SQL18</a></li>
    <li><a href="#sql19">SQL19</a></li>
    <li><a href="#sql20">SQL20</a></li>
    <li><a href="#sql21">SQL21</a></li>
    <li><a href="#sql22">SQL22</a></li>
    <li><a href="#sql23">SQL23</a></li>
    <li><a href="#sql24">SQL24</a></li>
    <li><a href="#sql25">SQL25</a></li>
    <li><a href="#sql26">SQL26</a></li>
    <li><a href="#sql27">SQL27</a></li>
    <li><a href="#sql28">SQL28</a></li>
    <li><a href="#sql29">SQL29</a></li>
    <li><a href="#sql30">SQL30</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><blockquote>
<p>链接： <a href="https://www.nowcoder.com/ta/sql">https://www.nowcoder.com/ta/sql</a></p>
</blockquote>
<h2 id="sql1">SQL1</h2>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">from</span> <span class="n">employees</span> <span class="k">Order</span> <span class="k">BY</span> <span class="n">hire_date</span> <span class="k">DESC</span> <span class="k">LIMIT</span> <span class="mi">1</span><span class="p">;</span>
</code></pre></div><h2 id="sql2">SQL2</h2>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="c1">-- OFFSET要在limit后面，这样可以选出倒数第三个
</span><span class="c1"></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">from</span> <span class="n">employees</span> <span class="k">Order</span> <span class="k">BY</span> <span class="n">hire_date</span> <span class="k">DESC</span> <span class="k">LIMIT</span> <span class="mi">1</span> <span class="k">OFFSET</span> <span class="mi">2</span><span class="p">;</span>
</code></pre></div><h2 id="sql3">SQL3</h2>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">salaries</span><span class="p">.</span><span class="o">*</span><span class="p">,</span><span class="n">dept_manager</span><span class="p">.</span><span class="n">dept_no</span> <span class="k">FROM</span> <span class="n">salaries</span> <span class="k">LEFT</span> <span class="k">JOIN</span> 
<span class="n">dept_manager</span> <span class="k">ON</span> <span class="n">salaries</span><span class="p">.</span><span class="n">emp_no</span> <span class="o">=</span> <span class="n">dept_manager</span><span class="p">.</span><span class="n">emp_no</span> 
<span class="k">WHERE</span> <span class="n">salaries</span><span class="p">.</span><span class="n">to_date</span><span class="o">=</span><span class="s1">&#39;9999-01-01&#39;</span> <span class="k">AND</span> <span class="n">dept_manager</span><span class="p">.</span><span class="n">to_date</span> <span class="o">=</span> 
<span class="s1">&#39;9999-01-01&#39;</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">salaries</span><span class="p">.</span><span class="n">emp_no</span> <span class="k">asc</span><span class="p">;</span>
</code></pre></div><h2 id="sql4">SQL4</h2>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">employees</span><span class="p">.</span><span class="n">last_name</span><span class="p">,</span><span class="n">employees</span><span class="p">.</span><span class="n">first_name</span><span class="p">,</span><span class="n">dept_emp</span><span class="p">.</span><span class="n">dept_no</span> <span class="k">FROM</span> 
<span class="n">dept_emp</span> <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">employees</span> <span class="k">ON</span> <span class="n">dept_emp</span><span class="p">.</span><span class="n">emp_no</span> <span class="o">=</span> <span class="n">employees</span><span class="p">.</span><span class="n">emp_no</span><span class="p">;</span>
</code></pre></div><h2 id="sql5">SQL5</h2>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">employees</span><span class="p">.</span><span class="n">last_name</span><span class="p">,</span><span class="n">employees</span><span class="p">.</span><span class="n">first_name</span><span class="p">,</span><span class="n">dept_emp</span><span class="p">.</span><span class="n">dept_no</span> <span class="k">FROM</span> <span class="n">employees</span> <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">dept_emp</span> 
<span class="k">ON</span> <span class="n">employees</span><span class="p">.</span><span class="n">emp_no</span> <span class="o">=</span> <span class="n">dept_emp</span><span class="p">.</span><span class="n">emp_no</span><span class="p">;</span>
</code></pre></div><h2 id="sql6">SQL6</h2>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">employees</span><span class="p">.</span><span class="n">emp_no</span><span class="p">,</span><span class="n">salaries</span><span class="p">.</span><span class="n">salary</span> <span class="k">FROM</span> <span class="n">employees</span> <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">salaries</span> <span class="k">ON</span> <span class="n">employees</span><span class="p">.</span><span class="n">emp_no</span> <span class="o">=</span> 
<span class="n">salaries</span><span class="p">.</span><span class="n">emp_no</span> <span class="k">AND</span> <span class="n">salaries</span><span class="p">.</span><span class="n">from_date</span> <span class="o">=</span> <span class="n">employees</span><span class="p">.</span><span class="n">hire_date</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">employees</span><span class="p">.</span><span class="n">emp_no</span> <span class="k">DESC</span><span class="p">;</span> 
</code></pre></div><p>前面的几个where是在链接好了之后再进行排序，on是在生成临时表的时候就排序，两个还是不太一样的。</p>
<h2 id="sql7">SQL7</h2>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">emp_no</span><span class="p">,</span><span class="k">count</span><span class="p">(</span><span class="n">emp_no</span><span class="p">)</span> <span class="k">AS</span> <span class="n">t</span> <span class="k">FROM</span> <span class="n">salaries</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">emp_no</span> <span class="k">HAVING</span> <span class="n">t</span> <span class="o">&gt;</span>
<span class="mi">15</span><span class="p">;</span>
</code></pre></div><p>思路就是先GROUP分组，然后再看看分好的组里面哪个大于15</p>
<h2 id="sql8">SQL8</h2>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="n">salary</span> <span class="k">FROM</span> <span class="n">salaries</span> <span class="k">WHERE</span> <span class="n">salaries</span><span class="p">.</span><span class="n">to_date</span> <span class="o">=</span> <span class="s1">&#39;9999-01-01&#39;</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">salaries</span><span class="p">.</span><span class="n">salary</span> <span class="k">DESC</span><span class="p">;</span>
</code></pre></div><p>这一题比较简单</p>
<h2 id="sql9">SQL9</h2>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">dept_manager</span><span class="p">.</span><span class="n">dept_no</span><span class="p">,</span><span class="n">dept_manager</span><span class="p">.</span><span class="n">emp_no</span><span class="p">,</span><span class="n">salaries</span><span class="p">.</span><span class="n">salary</span> <span class="k">FROM</span> <span class="n">dept_manager</span> <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">salaries</span> 
<span class="k">on</span> <span class="n">dept_manager</span><span class="p">.</span><span class="n">emp_no</span> <span class="o">=</span> <span class="n">salaries</span><span class="p">.</span><span class="n">emp_no</span> <span class="k">WHERE</span> <span class="n">dept_manager</span><span class="p">.</span><span class="n">to_date</span><span class="o">=</span><span class="s1">&#39;9999-01-01&#39;</span> <span class="k">AND</span> 
<span class="n">salaries</span><span class="p">.</span><span class="n">to_date</span><span class="o">=</span><span class="s1">&#39;9999-01-01&#39;</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">dept_manager</span><span class="p">.</span><span class="n">dept_no</span> <span class="k">ASC</span><span class="p">;</span>
</code></pre></div><h2 id="sql10">SQL10</h2>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">employees</span><span class="p">.</span><span class="n">emp_no</span> <span class="k">FROM</span> <span class="n">employees</span> <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">dept_manager</span> <span class="k">ON</span> <span class="n">employees</span><span class="p">.</span><span class="n">emp_no</span> <span class="o">=</span> <span class="n">dept_manager</span><span class="p">.</span><span class="n">emp_no</span> <span class="k">WHERE</span> <span class="n">dept_manager</span><span class="p">.</span><span class="n">dept_no</span> <span class="k">IS</span> <span class="k">NULL</span><span class="p">;</span>
</code></pre></div><p>这道题目有点坑，dept_no是主管的id，有这个的才是主管，</p>
<h2 id="sql11">SQL11</h2>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">dept_emp</span><span class="p">.</span><span class="n">emp_no</span><span class="p">,</span><span class="n">dept_manager</span><span class="p">.</span><span class="n">emp_no</span> <span class="k">FROM</span> <span class="n">dept_manager</span> <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">dept_emp</span> 
<span class="k">ON</span> <span class="n">dept_manager</span><span class="p">.</span><span class="n">dept_no</span> <span class="o">=</span> <span class="n">dept_emp</span><span class="p">.</span><span class="n">dept_no</span> <span class="k">WHERE</span> <span class="n">dept_manager</span><span class="p">.</span><span class="n">emp_no</span> <span class="o">!=</span> <span class="n">dept_emp</span><span class="p">.</span><span class="n">emp_no</span> 
<span class="k">AND</span> <span class="n">dept_manager</span><span class="p">.</span><span class="n">to_date</span><span class="o">=</span><span class="s1">&#39;9999-01-01&#39;</span><span class="p">;</span>
</code></pre></div><h2 id="sql12">SQL12</h2>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">ss</span><span class="p">.</span><span class="n">dept_no</span><span class="p">,</span><span class="n">d</span><span class="p">.</span><span class="n">emp_no</span><span class="p">,</span><span class="n">ss</span><span class="p">.</span><span class="n">maxSalary</span> <span class="k">FROM</span> <span class="p">(</span>
<span class="k">SELECT</span> <span class="n">d</span><span class="p">.</span><span class="n">dept_no</span><span class="p">,</span><span class="k">MAX</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">salary</span><span class="p">)</span> <span class="k">AS</span> <span class="n">maxSalary</span> <span class="k">FROM</span> <span class="n">salaries</span> <span class="k">AS</span> <span class="n">s</span><span class="p">,</span><span class="n">dept_emp</span> <span class="k">AS</span> <span class="n">d</span>
    <span class="k">WHERE</span> <span class="n">s</span><span class="p">.</span><span class="n">emp_no</span> <span class="o">=</span> <span class="n">d</span><span class="p">.</span><span class="n">emp_no</span>
    <span class="k">AND</span> <span class="n">s</span><span class="p">.</span><span class="n">to_date</span><span class="o">=</span><span class="s1">&#39;9999-01-01&#39;</span> 
    <span class="k">AND</span> <span class="n">d</span><span class="p">.</span><span class="n">to_date</span> <span class="o">=</span> <span class="s1">&#39;9999-01-01&#39;</span>
    <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">d</span><span class="p">.</span><span class="n">dept_no</span>
<span class="p">)</span> <span class="k">AS</span> <span class="n">ss</span> <span class="p">,</span><span class="n">dept_emp</span> <span class="k">AS</span> <span class="n">d</span><span class="p">,</span><span class="n">salaries</span> <span class="k">AS</span> <span class="n">s</span>
<span class="k">WHERE</span> <span class="n">ss</span><span class="p">.</span><span class="n">maxSalary</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">salary</span>
<span class="k">AND</span> <span class="n">ss</span><span class="p">.</span><span class="n">dept_no</span> <span class="o">=</span> <span class="n">d</span><span class="p">.</span><span class="n">dept_no</span> 	 <span class="c1">-- 查询出来的dept_no要和dept_no一致
</span><span class="c1"></span><span class="k">AND</span> <span class="n">d</span><span class="p">.</span><span class="n">emp_no</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">emp_no</span> 
<span class="k">AND</span> <span class="n">d</span><span class="p">.</span><span class="n">to_date</span> <span class="o">=</span> <span class="s1">&#39;9999-01-01&#39;</span> <span class="c1">-- 题目限定条件
</span><span class="c1"></span><span class="k">AND</span> <span class="n">s</span><span class="p">.</span><span class="n">to_date</span> <span class="o">=</span> <span class="s1">&#39;9999-01-01&#39;</span> <span class="c1">-- 题目限定条件
</span><span class="c1"></span><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">d</span><span class="p">.</span><span class="n">dept_no</span> <span class="k">ASC</span><span class="p">;</span>
</code></pre></div><p>这一题比较复杂，思路就是先在salaries表和dept_emp表中按部门编号（dept_no）分组，然后取salary最大的，这样就可以得到单个员工最大的工资了。</p>
<p>这样得到的结果是:</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="o">+</span><span class="c1">---------+-----------+
</span><span class="c1"></span><span class="o">|</span> <span class="n">dept_no</span> <span class="o">|</span> <span class="n">maxSalary</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---------+-----------+
</span><span class="c1"></span><span class="o">|</span> <span class="n">d001</span>    <span class="o">|</span>     <span class="mi">88958</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---------+-----------+
</span></code></pre></div><p>然后这个时候再把这个得到的表和dept_emp,salaries一起查找查找的条件就是</p>
<h2 id="sql13">SQL13</h2>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">title</span><span class="p">,</span><span class="k">COUNT</span><span class="p">(</span><span class="n">title</span><span class="p">)</span> <span class="n">T</span>
<span class="k">FROM</span> <span class="n">titles</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">title</span> <span class="k">HAVING</span> <span class="n">T</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">;</span>
</code></pre></div><h2 id="sql14">SQL14</h2>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">title</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">emp_no</span><span class="p">)</span> <span class="n">t</span>
<span class="k">FROM</span> <span class="n">titles</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">title</span>
<span class="k">HAVING</span> <span class="n">t</span><span class="o">&gt;=</span><span class="mi">2</span><span class="p">;</span>
</code></pre></div><p>思路就是在统计的时候就把emp_no去重</p>
<h2 id="sql15">SQL15</h2>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">employees</span>
<span class="k">WHERE</span> <span class="n">last_name</span> <span class="o">&lt;&gt;</span> <span class="s1">&#39;Mary&#39;</span>
<span class="k">AND</span> <span class="n">emp_no</span><span class="o">%</span><span class="mi">2</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">hire_date</span> <span class="k">DESC</span><span class="p">;</span>
</code></pre></div><p>筛选字符用&lt;&gt;，表示last_name != Mary</p>
<h2 id="sql16">SQL16</h2>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">t</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="k">AVG</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">salary</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">salaries</span> <span class="n">s</span><span class="p">,</span><span class="n">titles</span> <span class="n">t</span>
<span class="k">WHERE</span> <span class="n">s</span><span class="p">.</span><span class="n">to_date</span> <span class="o">=</span> <span class="s1">&#39;9999-01-01&#39;</span>
    <span class="k">AND</span> <span class="n">t</span><span class="p">.</span><span class="n">to_date</span> <span class="o">=</span> <span class="s1">&#39;9999-01-01&#39;</span> 
    <span class="k">AND</span> <span class="n">s</span><span class="p">.</span><span class="n">emp_no</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">emp_no</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">t</span><span class="p">.</span><span class="n">title</span><span class="p">;</span>
</code></pre></div><h2 id="sql17">SQL17</h2>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">emp_no</span><span class="p">,</span><span class="n">salary</span> <span class="k">FROM</span> <span class="n">salaries</span>
<span class="k">WHERE</span> <span class="n">to_date</span> <span class="o">=</span> <span class="s1">&#39;9999-01-01&#39;</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">salary</span> <span class="k">DESC</span> <span class="k">LIMIT</span> <span class="mi">1</span> <span class="k">OFFSET</span> <span class="mi">1</span><span class="p">;</span>
</code></pre></div><p>这一题比较简单，注意offset放在limit后面就行了</p>
<h2 id="sql18">SQL18</h2>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">e</span><span class="p">.</span><span class="n">emp_no</span><span class="p">,</span><span class="n">s</span><span class="p">.</span><span class="n">salary</span><span class="p">,</span><span class="n">e</span><span class="p">.</span><span class="n">last_name</span><span class="p">,</span><span class="n">e</span><span class="p">.</span><span class="n">first_name</span> <span class="k">FROM</span> <span class="n">employees</span> <span class="n">e</span> 
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">salaries</span> <span class="n">s</span>		<span class="c1">-- inner连接
</span><span class="c1"></span><span class="k">ON</span> <span class="n">s</span><span class="p">.</span><span class="n">emp_no</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">emp_no</span>
<span class="k">AND</span> <span class="n">s</span><span class="p">.</span><span class="n">to_date</span> <span class="o">=</span> <span class="s1">&#39;9999-01-01&#39;</span>
<span class="k">WHERE</span> <span class="n">s</span><span class="p">.</span><span class="n">salary</span> <span class="o">=</span> <span class="p">(</span>
  			<span class="k">SELECT</span> <span class="k">MAX</span><span class="p">(</span><span class="n">s2</span><span class="p">.</span><span class="n">salary</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">salaries</span> <span class="n">s2</span> <span class="c1">-- 再从比最大的小的记录中找到最大的，也就是可以找到第二大的了
</span><span class="c1"></span>      	<span class="k">WHERE</span> <span class="n">s2</span><span class="p">.</span><span class="n">salary</span> <span class="o">&lt;</span> <span class="p">(</span><span class="k">SELECT</span> <span class="k">MAX</span><span class="p">(</span><span class="n">salary</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">salaries</span> <span class="c1">--先找到最大的
</span><span class="c1"></span>                           <span class="k">WHERE</span> <span class="n">to_date</span> <span class="o">=</span> <span class="s1">&#39;9999-01-01&#39;</span><span class="p">)</span>
      <span class="k">AND</span> <span class="n">s2</span><span class="p">.</span><span class="n">to_date</span> <span class="o">=</span> <span class="s1">&#39;9999-01-01&#39;</span><span class="p">);</span>
</code></pre></div><h2 id="sql19">SQL19</h2>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">e</span><span class="p">.</span><span class="n">last_name</span><span class="p">,</span><span class="n">e</span><span class="p">.</span><span class="n">first_name</span><span class="p">,</span><span class="n">dd</span><span class="p">.</span><span class="n">dept_name</span> <span class="k">FROM</span>
<span class="n">employees</span> <span class="n">e</span> <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="p">(</span>
    <span class="k">SELECT</span> <span class="n">dept_name</span><span class="p">,</span><span class="n">emp_no</span> <span class="k">FROM</span> <span class="n">departments</span> <span class="n">d</span><span class="p">,</span><span class="n">dept_emp</span> <span class="n">de</span> <span class="k">WHERE</span> <span class="n">d</span><span class="p">.</span><span class="n">dept_no</span> <span class="o">=</span> <span class="n">de</span><span class="p">.</span><span class="n">dept_no</span>
<span class="p">)</span> <span class="k">AS</span> <span class="n">dd</span>
<span class="k">ON</span> <span class="n">dd</span><span class="p">.</span><span class="n">emp_no</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">emp_no</span>
</code></pre></div><h2 id="sql20">SQL20</h2>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="p">(</span><span class="k">MAX</span><span class="p">(</span><span class="n">salary</span><span class="p">)</span> <span class="o">-</span> <span class="k">MIN</span><span class="p">(</span><span class="n">salary</span><span class="p">))</span> <span class="k">AS</span> <span class="n">growth</span> <span class="k">FROM</span> <span class="n">salaries</span>
<span class="k">WHERE</span> <span class="n">emp_no</span> <span class="o">=</span> <span class="mi">10001</span><span class="p">;</span>
</code></pre></div><p>这题比较简单没什么好说的</p>
<h2 id="sql21">SQL21</h2>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">a</span><span class="p">.</span><span class="n">emp_no</span><span class="p">,(</span><span class="n">b</span><span class="p">.</span><span class="n">salary</span> <span class="o">-</span> <span class="k">c</span><span class="p">.</span><span class="n">salary</span><span class="p">)</span> <span class="k">AS</span> <span class="n">growth</span>
<span class="k">FROM</span> <span class="n">employees</span> <span class="n">a</span> 
    <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">salaries</span> <span class="n">b</span> 
    <span class="k">ON</span> <span class="n">a</span><span class="p">.</span><span class="n">emp_no</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">emp_no</span> <span class="k">AND</span> <span class="n">b</span><span class="p">.</span><span class="n">to_date</span> <span class="o">=</span> <span class="s1">&#39;9999-01-01&#39;</span>
    <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">salaries</span> <span class="k">c</span>
    <span class="k">ON</span> <span class="n">a</span><span class="p">.</span><span class="n">emp_no</span> <span class="o">=</span> <span class="k">c</span><span class="p">.</span><span class="n">emp_no</span> <span class="k">AND</span> <span class="n">a</span><span class="p">.</span><span class="n">hire_date</span> <span class="o">=</span> <span class="k">c</span><span class="p">.</span><span class="n">from_date</span>
    <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">growth</span> <span class="k">ASC</span><span class="p">;</span>
</code></pre></div><p>本题一共选了三个临时表，第一个临时表是employee和salaries的交集，这次取交集把两个都有的emp_no和没有离职的给获取到了，</p>
<p>第二个临时表是employee和salaries的交集，这里面仍然要求emp_no为employee和salaries共有的，并且要求被入职时间=薪水开始记录的时间，因为题目要求<strong>查找所有员工入职以来薪水的涨幅情况</strong>，所以一定要把入职时间确定下来</p>
<h2 id="sql22">SQL22</h2>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">d</span><span class="p">.</span><span class="n">dept_no</span><span class="p">,</span> <span class="n">d</span><span class="p">.</span><span class="n">dept_name</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">AS</span> <span class="k">sum</span>
<span class="k">FROM</span> <span class="n">departments</span> <span class="k">AS</span> <span class="n">d</span><span class="p">,</span> <span class="n">dept_emp</span> <span class="k">AS</span> <span class="n">de</span><span class="p">,</span> <span class="n">salaries</span> <span class="k">AS</span> <span class="n">s</span>
<span class="k">WHERE</span> <span class="n">d</span><span class="p">.</span><span class="n">dept_no</span><span class="o">=</span><span class="n">de</span><span class="p">.</span><span class="n">dept_no</span>
<span class="k">AND</span> <span class="n">de</span><span class="p">.</span><span class="n">emp_no</span><span class="o">=</span><span class="n">s</span><span class="p">.</span><span class="n">emp_no</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">d</span><span class="p">.</span><span class="n">dept_no</span><span class="p">;</span>
</code></pre></div><p>这个题库有个很奇怪的地方，22题我用mysql每次提交都是16%通过率，欢乐sqlite就变成了100%通过率</p>
<p>这个思路就是先WHERE查询，找到departments</p>
<h2 id="sql23">SQL23</h2>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">s1</span><span class="p">.</span><span class="n">emp_no</span><span class="p">,</span> <span class="n">s1</span><span class="p">.</span><span class="n">salary</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">s2</span><span class="p">.</span><span class="n">salary</span><span class="p">)</span> <span class="k">AS</span> <span class="n">rank</span>
<span class="k">FROM</span> <span class="n">salaries</span> <span class="k">AS</span> <span class="n">s1</span><span class="p">,</span> <span class="n">salaries</span> <span class="k">AS</span> <span class="n">s2</span>
<span class="k">WHERE</span> <span class="n">s1</span><span class="p">.</span><span class="n">to_date</span> <span class="o">=</span> <span class="s1">&#39;9999-01-01&#39;</span>  
<span class="k">AND</span> <span class="n">s2</span><span class="p">.</span><span class="n">to_date</span> <span class="o">=</span> <span class="s1">&#39;9999-01-01&#39;</span> 
<span class="k">AND</span> <span class="n">s1</span><span class="p">.</span><span class="n">salary</span> <span class="o">&lt;=</span> <span class="n">s2</span><span class="p">.</span><span class="n">salary</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">s1</span><span class="p">.</span><span class="n">emp_no</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">s1</span><span class="p">.</span><span class="n">salary</span> <span class="k">DESC</span><span class="p">,</span> <span class="n">s1</span><span class="p">.</span><span class="n">emp_no</span> <span class="k">ASC</span>
</code></pre></div><p>解决思路是用两个表来进行排序</p>
<h2 id="sql24">SQL24</h2>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">de</span><span class="p">.</span><span class="n">dept_no</span><span class="p">,</span><span class="n">a</span><span class="p">.</span><span class="n">emp_no</span><span class="p">,</span><span class="n">s</span><span class="p">.</span><span class="n">salary</span>
<span class="k">FROM</span> <span class="p">(</span>
  <span class="k">SELECT</span> <span class="n">emp_no</span>
  <span class="k">FROM</span> <span class="n">employees</span> 
  <span class="k">WHERE</span> <span class="n">emp_no</span> <span class="k">NOT</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">emp_no</span>
  <span class="k">FROM</span> <span class="n">dept_manager</span><span class="p">)</span>
<span class="p">)</span> <span class="n">a</span> 
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">dept_emp</span> <span class="n">de</span> <span class="k">ON</span> <span class="n">a</span><span class="p">.</span><span class="n">emp_no</span><span class="o">=</span><span class="n">de</span><span class="p">.</span><span class="n">emp_no</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">salaries</span> <span class="n">s</span> <span class="k">ON</span> <span class="n">a</span><span class="p">.</span><span class="n">emp_no</span><span class="o">=</span><span class="n">s</span><span class="p">.</span><span class="n">emp_no</span>
<span class="k">WHERE</span> <span class="n">s</span><span class="p">.</span><span class="n">to_date</span><span class="o">=</span><span class="s1">&#39;9999-01-01&#39;</span>
</code></pre></div><p>先找到所有非manager员工emp_no,再内连接工资表和部门</p>
<h2 id="sql25">SQL25</h2>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">de</span><span class="p">.</span><span class="n">emp_no</span><span class="p">,</span><span class="c1">-- 员工的
</span><span class="c1"></span>       <span class="n">dm</span><span class="p">.</span><span class="n">emp_no</span> <span class="k">as</span> <span class="n">manager_no</span><span class="p">,</span><span class="c1">-- manager的
</span><span class="c1"></span>       <span class="n">s1</span><span class="p">.</span><span class="n">salary</span> <span class="k">as</span> <span class="n">emp_salary</span><span class="p">,</span><span class="c1">-- 员工薪水
</span><span class="c1"></span>       <span class="n">s2</span><span class="p">.</span><span class="n">salary</span> <span class="k">as</span> <span class="n">manager_salary</span> <span class="c1">-- manager薪水
</span><span class="c1"></span><span class="k">FROM</span> <span class="n">dept_emp</span> <span class="n">de</span><span class="p">,</span><span class="n">dept_manager</span> <span class="n">dm</span><span class="p">,</span><span class="n">salaries</span> <span class="n">s1</span><span class="p">,</span><span class="n">salaries</span> <span class="n">s2</span>
<span class="k">WHERE</span> <span class="n">de</span><span class="p">.</span><span class="n">dept_no</span><span class="o">=</span><span class="n">dm</span><span class="p">.</span><span class="n">dept_no</span>
<span class="k">AND</span> <span class="n">de</span><span class="p">.</span><span class="n">emp_no</span><span class="o">=</span><span class="n">s1</span><span class="p">.</span><span class="n">emp_no</span>
<span class="k">AND</span> <span class="n">dm</span><span class="p">.</span><span class="n">emp_no</span><span class="o">=</span><span class="n">s2</span><span class="p">.</span><span class="n">emp_no</span>
<span class="k">AND</span> <span class="n">s1</span><span class="p">.</span><span class="n">to_date</span><span class="o">=</span><span class="s1">&#39;9999-01-01&#39;</span>
<span class="k">AND</span> <span class="n">s2</span><span class="p">.</span><span class="n">to_date</span><span class="o">=</span><span class="s1">&#39;9999-01-01&#39;</span>
<span class="k">AND</span> <span class="n">s1</span><span class="p">.</span><span class="n">salary</span><span class="o">&gt;</span><span class="n">s2</span><span class="p">.</span><span class="n">salary</span>
</code></pre></div><p>s1中是所有员工的，s2是manager的，只要所有员工有大于manager表中的，那么就代表这是比manager大的</p>
<h2 id="sql26">SQL26</h2>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">d</span><span class="p">.</span><span class="n">dept_no</span><span class="p">,</span> <span class="n">d</span><span class="p">.</span><span class="n">dept_name</span><span class="p">,</span> <span class="n">t</span><span class="p">.</span><span class="n">title</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">title</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">departments</span> <span class="n">d</span> <span class="k">JOIN</span> <span class="n">dept_emp</span> <span class="n">de</span> <span class="k">ON</span> <span class="n">d</span><span class="p">.</span><span class="n">dept_no</span> <span class="o">=</span> <span class="n">de</span><span class="p">.</span><span class="n">dept_no</span>
<span class="k">JOIN</span> <span class="n">titles</span> <span class="n">t</span> <span class="k">ON</span> <span class="n">de</span><span class="p">.</span><span class="n">emp_no</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">emp_no</span>
<span class="k">WHERE</span> <span class="n">t</span><span class="p">.</span><span class="n">to_date</span> <span class="o">=</span> <span class="s1">&#39;9999-01-01&#39;</span>
<span class="k">AND</span> <span class="n">de</span><span class="p">.</span><span class="n">to_date</span> <span class="o">=</span> <span class="s1">&#39;9999-01-01&#39;</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">d</span><span class="p">.</span><span class="n">dept_no</span><span class="p">,</span> <span class="n">t</span><span class="p">.</span><span class="n">title</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">d</span><span class="p">.</span><span class="n">dept_no</span>
</code></pre></div><p>这里就直接join了，因为题目是要求的各个部门所有的员工的，然后根据部门编号和title分组，这样会出来所有的部门编号，然后就可以统计对应的title了</p>
<h2 id="sql27">SQL27</h2>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">s1</span><span class="p">.</span><span class="n">emp_no</span><span class="p">,</span><span class="n">s2</span><span class="p">.</span><span class="n">from_date</span><span class="p">,(</span><span class="n">s2</span><span class="p">.</span><span class="n">salary</span><span class="o">-</span><span class="n">s1</span><span class="p">.</span><span class="n">salary</span><span class="p">)</span> <span class="n">salary_growth</span>
<span class="k">FROM</span> <span class="n">salaries</span> <span class="n">s1</span>
<span class="k">JOIN</span> <span class="n">salaries</span> <span class="n">s2</span> <span class="k">ON</span> <span class="n">s1</span><span class="p">.</span><span class="n">emp_no</span> <span class="o">=</span> <span class="n">s2</span><span class="p">.</span><span class="n">emp_no</span> 
	<span class="k">AND</span> <span class="n">s1</span><span class="p">.</span><span class="n">to_date</span> <span class="o">=</span> <span class="n">s2</span><span class="p">.</span><span class="n">from_date</span>
<span class="k">WHERE</span> <span class="n">s2</span><span class="p">.</span><span class="n">salary</span><span class="o">-</span><span class="n">s1</span><span class="p">.</span><span class="n">salary</span> <span class="o">&gt;</span> <span class="mi">5000</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">salary_growth</span> <span class="k">DESC</span>
</code></pre></div><h2 id="sql28">SQL28</h2>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="k">c</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="k">COUNT</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">film_id</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">film</span> <span class="n">f</span> <span class="k">JOIN</span> <span class="n">film_category</span> <span class="n">fc</span> <span class="k">ON</span> <span class="n">f</span><span class="p">.</span><span class="n">film_id</span><span class="o">=</span><span class="n">fc</span><span class="p">.</span><span class="n">film_id</span>
<span class="k">JOIN</span> <span class="n">category</span> <span class="k">c</span> <span class="k">ON</span> <span class="n">fc</span><span class="p">.</span><span class="n">category_id</span><span class="o">=</span><span class="k">c</span><span class="p">.</span><span class="n">category_id</span>
<span class="k">WHERE</span> <span class="n">f</span><span class="p">.</span><span class="n">description</span> <span class="k">LIKE</span> <span class="s1">&#39;%robot%&#39;</span>
  <span class="k">AND</span> <span class="k">c</span><span class="p">.</span><span class="n">category_id</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">category_id</span>  <span class="k">FROM</span> <span class="n">film_category</span>  <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">category_id</span> 															<span class="k">HAVING</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">film_id</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">5</span><span class="p">)</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">c</span><span class="p">.</span><span class="n">name</span>
</code></pre></div><p>题目要求要分类，所以要先按照name分类，然后HAVING 把小于5的给筛选掉。</p>
<p>从电影分类表和电影总表中，根据film_id 联合起来，然后再和电影分类名称表根据电影分类的id联合起来，这样信息就全了，</p>
<p>然后筛选信息的时候就看看description是不是包含robot</p>
<p>并且category_id 也要在film_category的表中有大于5的电影</p>
<h2 id="sql29">SQL29</h2>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">f</span><span class="p">.</span><span class="n">film_id</span><span class="p">,</span> <span class="n">f</span><span class="p">.</span><span class="n">title</span>
<span class="k">FROM</span> <span class="n">film</span> <span class="k">AS</span> <span class="n">f</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">film_category</span> <span class="k">AS</span> <span class="n">fc</span>
<span class="k">ON</span> <span class="n">f</span><span class="p">.</span><span class="n">film_id</span><span class="o">=</span><span class="n">fc</span><span class="p">.</span><span class="n">film_id</span>
<span class="k">WHERE</span> <span class="n">category_id</span> <span class="k">IS</span> <span class="k">NULL</span><span class="p">;</span>
</code></pre></div><p>不管film_category表中有没有这个电影的记录，film表必须要有，所以用左连接</p>
<p>查询的结果如下所示</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="o">+</span><span class="c1">---------+------------------+-------------+
</span><span class="c1"></span><span class="o">|</span> <span class="n">film_id</span> <span class="o">|</span> <span class="n">title</span>            <span class="o">|</span> <span class="n">category_id</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---------+------------------+-------------+
</span><span class="c1"></span><span class="o">|</span>       <span class="mi">3</span> <span class="o">|</span> <span class="n">ADAPTATION</span> <span class="n">HOLES</span> <span class="o">|</span>        <span class="k">NULL</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---------+------------------+-------------+
</span></code></pre></div><h2 id="sql30">SQL30</h2>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">title</span><span class="p">,</span><span class="n">description</span>
<span class="k">FROM</span> <span class="p">(</span>
    <span class="k">SELECT</span> <span class="n">ff</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="n">ff</span><span class="p">.</span><span class="n">description</span><span class="p">,</span><span class="k">c</span><span class="p">.</span><span class="n">name</span>
    <span class="k">FROM</span> <span class="n">film_category</span> <span class="n">fc</span>
    <span class="k">JOIN</span> <span class="n">film</span> <span class="n">ff</span>
    <span class="k">ON</span> <span class="n">fc</span><span class="p">.</span><span class="n">film_id</span><span class="o">=</span><span class="n">ff</span><span class="p">.</span><span class="n">film_id</span>
    <span class="k">JOIN</span> <span class="n">category</span> <span class="k">c</span>
    <span class="k">ON</span> <span class="n">fc</span><span class="p">.</span><span class="n">category_id</span> <span class="o">=</span><span class="k">c</span><span class="p">.</span><span class="n">category_id</span>
<span class="p">)</span> <span class="n">f</span> 
<span class="k">WHERE</span> <span class="n">f</span><span class="p">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Action&#39;</span><span class="p">;</span>
</code></pre></div><p>film_category，film两个表先根据film_id进行连接，然后再和category进行连接，这样可以得到完整的包含title和description的联合表，其中必须要保证film和category的film_id和category_id在film_category有记录（连接的条件也只能是这样）</p>
<p>这样得到了一个大的信息表，然后再用where筛选就可以了</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2021-01-03</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/sql/">SQL</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/nginx/" class="prev" rel="prev" title="Nginx"><i class="fas fa-angle-left fa-fw"></i>Nginx</a>
            <a href="/posts/mysql%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/" class="next" rel="next" title="Mysql存储过程">Mysql存储过程<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2020 - 2021</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">氕氘氚</a></span><span class="icp-splitter">&nbsp;|&nbsp;</span><br class="icp-br"/>
                    <span class="icp">苏ICP备2020068321</span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.stemmer.support.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.zh.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{},"search":{"highlightTag":"em","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
